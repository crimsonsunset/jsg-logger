<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSG Logger DevTools Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        button {
            background: #4A90E2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        button:hover {
            background: #357ABD;
        }
        
        .danger {
            background: #E74C3C;
        }
        
        .danger:hover {
            background: #C0392B;
        }
        
        .success {
            background: #27AE60;
        }
        
        .success:hover {
            background: #229954;
        }
        
        .log-output {
            background: #2C3E50;
            color: #ECF0F1;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 12px;
            margin: 10px 0;
            min-height: 100px;
            overflow-y: auto;
        }
        
        h1 {
            color: #2C3E50;
        }
        
        h2 {
            color: #34495E;
            border-bottom: 2px solid #ECF0F1;
            padding-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>🎛️ JSG Logger DevTools Test Page</h1>
    
    <div class="test-section">
        <h2>📦 Logger Setup</h2>
        <p>This page loads JSG Logger with a test configuration and provides buttons to test logging and DevTools functionality.</p>
        <div id="setup-status">Loading...</div>
    </div>

    <div class="test-section">
        <h2>🎯 DevTools Panel Controls</h2>
        <button onclick="enableDevTools()">🎛️ Enable DevTools Panel</button>
        <button onclick="togglePanel()">👁️ Toggle Panel Visibility</button>
        <button onclick="destroyPanel()" class="danger">🗑️ Destroy Panel</button>
        <div id="devtools-status">DevTools not loaded</div>
    </div>

    <div class="test-section">
        <h2>🧪 Test Logging</h2>
        <button onclick="testBasicLogs()">📝 Basic Logs</button>
        <button onclick="testMultiComponent()">🔀 Multi-Component</button>
        <button onclick="testWithData()">📊 With Data</button>
        <button onclick="testErrorLog()" class="danger">🚨 Error Log</button>
        <button onclick="clearLogs()" class="success">🧹 Clear Console</button>
    </div>

    <div class="test-section">
        <h2>⚙️ Logger Controls Test</h2>
        <button onclick="enableDebugMode()">🐛 Debug All</button>
        <button onclick="enableTraceMode()">🔍 Trace All</button>
        <button onclick="silentMode()">🔇 Silent Mode</button>
        <button onclick="resetLogger()">↻ Reset Logger</button>
        <button onclick="showStats()">📊 Show Stats</button>
    </div>

    <div class="test-section">
        <h2>📋 Console Output</h2>
        <p>Open browser DevTools console to see logger output and DevTools panel interactions.</p>
        <div class="log-output" id="instructions">
            <strong>Instructions:</strong><br>
            1. Click "Enable DevTools Panel" to load the panel<br>
            2. Look for a floating 🎛️ button on the left side of the page<br>
            3. Click the floating button to open/close the panel<br>
            4. Use the test buttons to generate logs<br>
            5. Use the panel to filter components on/off<br>
            <br>
            <strong>Expected behavior:</strong><br>
            - Panel appears as a dark sidebar from the left<br>
            - Component toggles control log visibility in real-time<br>
            - Global controls affect all components<br>
            - Stats update automatically every 2 seconds
        </div>
    </div>

    <script type="module">
        // Import and initialize JSG Logger (browser-compatible version)
        import logger from './index.browser.js';

        // Create test configuration
        const testConfig = {
            projectName: "DevTools Test",
            globalLevel: "info",
            components: {
                core: { emoji: "🎯", color: "#4A90E2", level: "info" },
                api: { emoji: "🔌", color: "#FF5500", level: "debug" },
                ui: { emoji: "🎨", color: "#FF6B6B", level: "info" },
                database: { emoji: "💾", color: "#00C896", level: "warn" },
                test: { emoji: "🧪", color: "#FFEAA7", level: "debug" }
            }
        };

        // Initialize logger with test config
        logger.configManager.config = {...logger.configManager.config, ...testConfig};
        logger.controls.refresh();

        // Update setup status
        document.getElementById('setup-status').innerHTML = `
            ✅ JSG Logger initialized<br>
            🌍 Environment: ${logger.configManager?.config?.environment || 'browser'}<br>
            📦 Components: ${logger.controls.listComponents().join(', ')}<br>
            🎛️ Global controls available on window.JSG_Logger
        `;

        // Global test functions
        window.logger = logger;
        window.enableDevTools = async () => {
            console.log('[TEST] Enabling DevTools panel...');
            console.log('🔄 Cache-busting enabled - loading fresh DevTools version');
            
            // Clear any existing DevTools instances
            if (window.JSG_DevTools) {
                delete window.JSG_DevTools;
            }
            
            const panel = await logger.controls.enableDevPanel();
            const status = document.getElementById('devtools-status');
            
            if (panel) {
                status.innerHTML = '🔥 HOT RELOAD DEV MODE! DevTools loaded from SOURCE files - changes should be INSTANT! 🔥';
                status.style.color = '#00ff00';
                status.style.fontWeight = 'bold';
                status.style.fontSize = '16px';
                console.log('🔥 HOT RELOAD: DevTools loaded from source - edit files and see immediate changes!');
            } else {
                status.innerHTML = '❌ Failed to enable DevTools panel';
                status.style.color = '#E74C3C';
            }
        };

        window.togglePanel = () => {
            if (window.JSG_DevTools) {
                window.JSG_DevTools.toggle();
                console.log('[TEST] Toggled panel visibility');
            } else {
                console.warn('[TEST] DevTools not loaded yet');
            }
        };

        window.destroyPanel = () => {
            if (window.JSG_DevTools) {
                window.JSG_DevTools.destroy();
                document.getElementById('devtools-status').innerHTML = '🗑️ DevTools panel destroyed';
                console.log('[TEST] DevTools panel destroyed');
            } else {
                console.warn('[TEST] DevTools not loaded yet');
            }
        };

        window.testBasicLogs = () => {
            logger.core.info('Basic info log from core component');
            logger.api.debug('API debug message');
            logger.ui.info('UI component info');
            console.log('[TEST] Basic logs sent');
        };

        window.testMultiComponent = () => {
            logger.core.info('Multi-component test started');
            logger.api.debug('API processing request', { endpoint: '/test', method: 'GET' });
            logger.database.warn('Database connection slow', { latency: '150ms' });
            logger.ui.info('UI update triggered', { component: 'TestButton' });
            logger.test.debug('Test data generated', { testId: 'mt-001', success: true });
            console.log('[TEST] Multi-component logs sent');
        };

        window.testWithData = () => {
            const testData = {
                user: { id: 123, name: 'Test User' },
                request: { url: '/api/test', timestamp: new Date().toISOString() },
                response: { status: 200, data: { success: true, items: ['a', 'b', 'c'] } },
                metrics: { duration: '45ms', memory: '12.3MB' }
            };

            logger.api.info('Request completed successfully', testData);
            logger.database.debug('Query executed', { 
                query: 'SELECT * FROM test_table', 
                rows: 42,
                execution_time: '5ms' 
            });
            console.log('[TEST] Data-rich logs sent');
        };

        window.testErrorLog = () => {
            const error = new Error('Test error for DevTools');
            logger.api.error('Test error occurred', { 
                error: error.message,
                stack: error.stack,
                context: 'DevTools testing' 
            });
            logger.core.fatal('Critical test failure', { 
                component: 'test-system',
                recovery: 'manual intervention required' 
            });
            console.log('[TEST] Error logs sent');
        };

        window.clearLogs = () => {
            console.clear();
            console.log('[TEST] Console cleared');
        };

        window.enableDebugMode = () => {
            logger.controls.enableDebugMode();
            console.log('[TEST] Debug mode enabled for all components');
        };

        window.enableTraceMode = () => {
            logger.controls.enableTraceMode();
            console.log('[TEST] Trace mode enabled for all components');
        };

        window.silentMode = () => {
            ['core', 'api', 'ui', 'database', 'test'].forEach(comp => {
                logger.controls.setLevel(comp, 'silent');
            });
            console.log('[TEST] All components set to silent');
        };

        window.resetLogger = () => {
            logger.controls.reset();
            // Re-apply test config after reset
            logger.configManager.config = {...logger.configManager.config, ...testConfig};
            logger.controls.refresh();
            console.log('[TEST] Logger reset and test config reapplied');
        };

        window.showStats = () => {
            const stats = logger.controls.getStats();
            const summary = logger.controls.getConfigSummary();
            console.log('[TEST] Logger Stats:', stats);
            console.log('[TEST] Config Summary:', summary);
        };

        // Auto-enable some test logs on page load
        setTimeout(() => {
            logger.core.info('🎯 DevTools test page loaded successfully');
            logger.test.debug('Ready for DevTools panel testing');
        }, 500);
    </script>
</body>
</html>
